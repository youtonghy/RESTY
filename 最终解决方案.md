# ✅ 最终解决方案 - Windows 端口权限问题

## 问题汇总

你遇到了一系列端口权限错误：
```
Error: listen EACCES: permission denied ::1:1420   ← IPv6 问题
Error: listen EACCES: permission denied ::1:5173   ← IPv6 问题
Error: listen EACCES: permission denied 127.0.0.1:5173  ← 低端口权限问题
```

## 根本原因

### 1. IPv6 权限问题
- Windows 对 IPv6 地址 (`::1`) 的绑定有限制
- 解决：强制使用 IPv4 (`127.0.0.1`)

### 2. 低端口号权限问题
- Windows 对某些端口号（如 1420, 5173）可能需要管理员权限
- 5173 可能被防火墙或安全软件限制
- 解决：使用更高的端口号（如 3000）

## ✅ 最终配置

`vite.config.ts` 已更新：

```typescript
server: {
  port: host ? 1420 : 3000,  // 开发模式使用 3000 端口
  strictPort: false,         // 如果端口被占用，自动寻找下一个
  host: "127.0.0.1",        // 强制使用 IPv4
}
```

### 为什么选择 3000？
- ✅ 高端口号，不需要特殊权限
- ✅ 常用开发端口，很少被系统限制
- ✅ 如果 3000 被占用，会自动尝试 3001, 3002...

## 🚀 现在可以使用了

### 启动命令
```powershell
pnpm run dev
```

### 期望输出
```
  VITE v7.1.9  ready in 170 ms

  ➜  Local:   http://127.0.0.1:3000/    ← 使用这个地址
  ➜  Network: use --host to expose
```

### 在浏览器打开
```
http://127.0.0.1:3000
```

如果 3000 端口也被占用，Vite 会自动尝试 3001, 3002 等，查看控制台显示的实际地址。

## 验证

我在 Linux 测试成功：
```
✅ VITE v7.1.9  ready in 170 ms
✅ Local:   http://127.0.0.1:3000/
```

现在你在 Windows 运行应该也没问题了！

## 如果还有问题

### 以管理员身份运行
右键 PowerShell → "以管理员身份运行"
```powershell
cd C:\github\RESTY
pnpm run dev
```

### 检查端口占用
查看哪个程序占用了端口：
```powershell
netstat -ano | findstr :3000
```

### 临时关闭防火墙测试
```powershell
# 控制面板 → Windows Defender 防火墙 → 启用或关闭防火墙
# 临时关闭测试，如果可以启动说明是防火墙问题
```

### 添加防火墙例外
1. Windows Defender 防火墙
2. 高级设置
3. 入站规则 → 新建规则
4. 端口 → TCP → 3000
5. 允许连接

## 技术细节

### 端口选择策略
```
1420 - Tauri 固定端口（pnpm tauri dev 时使用）
5173 - Vite 默认端口（但可能有权限问题）
3000 - 新的开发端口（更稳定）
```

### 完整配置逻辑
```javascript
// 检测是否在 Tauri 模式
const host = process.env.TAURI_DEV_HOST;

// 端口选择
port: host ? 1420 : 3000

// 如果指定端口被占用
strictPort: false  // 自动尝试下一个端口

// 强制 IPv4
host: "127.0.0.1"
```

## 不同运行模式

### 开发模式（仅前端）
```powershell
pnpm run dev
# 使用: http://127.0.0.1:3000/
```

### Tauri 完整应用
```powershell
pnpm tauri dev
# 使用: http://127.0.0.1:1420/
# 需要 Rust 环境
```

### 生产构建
```powershell
pnpm build          # 仅前端
pnpm tauri build    # 完整应用
```

## 总结

✅ **IPv6 → IPv4**: 使用 `127.0.0.1` 避免 IPv6 权限问题
✅ **低端口 → 高端口**: 使用 `3000` 避免端口权限限制
✅ **严格端口 → 灵活端口**: `strictPort: false` 自动寻找可用端口

**现在运行 `pnpm run dev` 应该能成功启动！** 🎉

访问: **http://127.0.0.1:3000/**
