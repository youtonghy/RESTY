---

# 一、产品定位（Product Vision）

构建一款基于 Tauri 与 React 的跨平台桌面应用（Windows/macOS/Linux），用于定期进行「护眼休息提醒」。应用需具备极简清新（minimal & fresh）的界面风格、可主题化（themable）与可扩展（extensible），并提供使用统计（analytics）与智能提醒（smart deferral）。

---

# 二、核心目标（Goals）

1. 让用户以可配置的「工作—休息」节奏（类似番茄钟）规律用眼，降低疲劳。
2. 提供覆盖所有平台的一致体验：低资源占用、稳定、可访问（a11y）。
3. 支持主题与语言的后期自定义，默认英文界面，中文通过语言文件加载。

---

# 三、用户与场景（Users & Scenarios）

* 目标用户：长时间屏幕工作者（学生、工程师、设计师等）。
* 核心场景：

  * 按自定义间隔弹出提醒，全屏（fullscreen overlay）或浮窗（floating window）展示休息引导与倒计时。
  * 在演示或游戏全屏、系统勿扰（Do Not Disturb）等情况下，提醒智能延后。
  * 查看今日/周/月的使用与休息统计，回顾习惯与完成率。

---

# 四、范围与功能（Scope & Features）

## 4.1 必备功能（Must-haves）

* 定时调度（scheduler）：工作时长、休息时长、是否强制休息、提醒模式。
* 提醒视图（reminder view）：全屏或浮窗,可在屏幕右上角弹出弹窗,或者弹出全屏弹窗,都保持置顶；倒计时；按钮操作（跳过、延长、立即休息）。
* 统计（analytics）：按时间范围展示总工作/总休息时长、休息次数、完成率、时间轴。
* 设置（settings）：所有参数可配置并持久化；导入/导出；主题切换；语言切换。
* 系统托盘（system tray）：常驻并提供快捷操作。
* 全局快捷键（global shortcuts）：开始/暂停、跳过、延长、立即休息、模式切换。
* 开机自启（autostart）与系统通知（native notifications）。
* 多显示器（multi-monitor）支持：可选显示屏幕策略。

## 4.2 可选增强（Should-haves）

* 智能延后（smart deferral）：检测全屏与勿扰状态。
* 睡眠/唤醒（sleep/wake）恢复策略：重算剩余时间或顺延。
* 主题包（theme pack）机制与配色（color scheme）预设。

## 4.3 非目标（Out of Scope）

* 云端同步与账号体系（后续预留扩展接口，不在首版实现）。
* 复杂团队共享统计（首版仅本地统计）。

---

# 五、非功能要求（Non-Functional Requirements）

* 跨平台一致性：窗口、通知、托盘、快捷键统一抽象。
* 性能：后台常驻 CPU 占用极低，长时间运行无明显时钟漂移。
* 稳定性：单实例（single instance）、异常恢复、持久化可靠。
* 可访问性（a11y）：键盘可达、ARIA 标签、暗/亮模式与高对比度支持。
* 隐私：本地数据，不默认收集任何个人信息。
* 安全：对配置读写与导入/导出进行基本校验与沙盒化处理。

---

# 六、信息架构与导航（Information Architecture & Navigation）

* 主窗口（main window）：路由包含设置（settings）、统计（analytics）。
* 提醒窗口（reminder window）：全屏模式与浮窗模式。
* 系统托盘（tray）：显示状态与快速操作入口。
* 默认路由：启动后进入设置页；统计可从侧边或顶部导航进入。

---

# 七、界面与交互规范（UI/UX Guidelines）

* 风格：极简清新；系统字体栈；适度留白；圆角与柔和阴影。
* 色彩：通过 CSS 变量暴露主题色与基础色，支持暗/亮模式即时切换。
* 动效：轻量过渡，倒计时环形或条形进度；反馈明确、节奏轻快。
* 关键视图内容：

  * 设置页：计时、提醒、外观、系统与语言分组；保存、恢复默认、导入/导出。
  * 统计页：概要指标卡片、时间范围选择、时间轴视图。
  * 提醒页：大号标题与倒计时、明确的操作按钮；强制休息时限制可用操作（可配置）。

---

# 八、国际化与编码策略（i18n & Encoding Policy）——强制执行

1. 默认语言为英文（en-US）。
2. 中文（zh-CN）与其他语言均通过语言文件（language files）提供，不得在源码中硬编码中文文本。
3. 语言文件放置在专用目录，按领域分组键名（如 settings、actions、reminder、analytics、errors）。
4. 源码、配置与语言文件统一使用 UTF-8（无 BOM）。
5. 首次启动默认英文；用户手动切换语言后写入设置并持久化，重启后沿用。
6. 所有界面可见文本、系统托盘与通知文本、错误提示均通过语言键（key）与参数插值实现。
7. 日志（log）、代码标识符、注释统一使用英文。
8. 持续集成（CI）需包含以下守卫：

   * 源码中文字符扫描（排除语言文件目录），防止中文硬编码与潜在乱码。
   * 语言键一致性校验（至少保证 en 与 zh-CN 键集合一致）。
   * 文件编码检查，禁止非 UTF-8 或带 BOM 的文件进入主分支。

---

# 九、注释与文档规范（Code Comments & Docs）——强制执行

1. 前端（TypeScript/React）：对导出函数、组件、类型使用结构化文档注释；对复杂状态机、计时与跨进程交互处添加说明性注释。
2. 后端（Rust/Tauri 主进程）：对命令（command）、模块（module）与平台差异分支提供文档注释；错误类型与返回约定需明确。
3. 测试：用例意图清晰，指出覆盖目标、时间推进与模拟策略。
4. 架构文档：提供 README 与开发指南（包含架构总览、构建说明、运行与调试步骤、打包与签名说明、常见问题）。

---

# 十、技术架构（Architecture）

* 应用框架：Tauri（Rust 主进程）+ React（渲染进程）+ TypeScript。
* 状态管理：轻量 store（如 Zustand 或等价方案）。
* IPC（invoke/event）：主进程提供命令与事件，渲染进程订阅与调用。
* 持久化：本地数据库（SQLite 或等价方案）与版本化迁移；初版可选 JSON 存储但需抽象与迁移路径。
* 图表与可视化：轻量级方案；保证在低配置设备流畅。
* 日志：统一英文、分级可控、便于排查。

---

# 十一、IPC 命令与事件（IPC Commands & Events）

## 11.1 命令（Commands）

* 读取/保存设置
* 启动/暂停/继续工作—休息周期
* 跳过当前阶段
* 延长休息时长
* 获取统计数据（按时间范围）
* 导入/导出配置
* 设置开机自启
* 开关托盘常驻
* 切换语言（仅写设置，不返回本地化文本）
* 枚举显示器信息
* 打开/关闭提醒窗口（全屏/浮窗）

## 11.2 事件（Events）

* 定时心跳（剩余时间）
* 阶段切换（工作↔休息）
* 提醒窗口开/关
* 设置变更
* 系统状态通知（如唤醒、勿扰变化）

---

# 十二、定时与系统集成（Scheduling & OS Integration）

* 主进程统一时钟源，确保高精度与低漂移。
* 处理睡眠/唤醒：按配置选择重置或顺延策略，并给出合适提示。
* 全屏/勿扰检测：可配置智能延后策略，避免打断关键场景。
* 托盘与全局快捷键：跨平台实现，确保冲突检测与回退策略。
* 多实例：默认单实例，重复启动时聚焦已有实例。

---

# 十三、数据模型与迁移（Data Model & Migration）

* 设置（settings）：包含工作/休息时长、模式、强制休息、浮窗位置与透明度、声音、主题、开机自启、语言、版本与时间戳。
* 会话（sessions）：记录每段工作/休息的起止时间、是否跳过、延长时长与备注。
* 迁移机制：语义化版本（semver），支持向后兼容与默认值填充；导入配置时进行版本转换与校验。

---

# 十四、校验与错误处理（Validation & Error Handling）

* 前后端均进行参数与边界校验（双保险）。
* 工作/休息时间不可为 0 或超出合理上限；透明度、位置与主题等参数需在合法集合内。
* 错误对外以错误码或键值返回，前端根据语言文件展示本地化消息。
* 日志记录错误上下文，避免泄露隐私。

---

# 十五、组件与页面（Components & Pages）

* 设置页面：分区清晰；包含保存、恢复默认、导入/导出与语言/主题切换。
* 提醒视图组件：全屏与浮窗两类；倒计时、操作按钮与状态提示；强制休息时限制交互。
* 统计页面：关键指标卡片、时间范围切换、时间轴视图。
* 主题与语言提供器（provider）：统一管理主题变量与语言切换。
* 托盘与快捷键管理器：仅作为渲染层的调用代理与状态桥接。

---

# 十六、可访问性与多显示器（Accessibility & Multi-Monitor）

* 键盘导航可达；焦点样式清晰；ARIA 标签完善。
* 暗/亮模式与高对比度主题具备即时切换能力。
* 支持指定提醒出现的显示器策略：主显示器、所有显示器、上次活动显示器等。

---

# 十七、日志与监控（Logging & Observability）

* 按级别输出日志，开发与生产可分别配置。
* 若引入崩溃或性能匿名遥测，需默认关闭并可视化告知与一键清除。

---

# 十八、构建与发布（Build & Release）

* 使用稳定版本的 Node、Rust、Tauri 与相关依赖。
* 提供开发、测试、构建与打包脚本；三平台打包产物。
* 代码签名与公证流程留出配置占位与说明，便于后续启用。
* 确保语言文件与静态资源正确打包并按需加载。

---

# 十九、测试策略（Testing Strategy）

* 单元测试：设置校验、计时与阶段切换、跨进程接口。
* 组件/界面测试：提醒视图交互、主题与语言切换、可访问性。
* 集成测试：主/渲染进程通信、事件订阅与状态同步。
* 端到端测试（E2E）：启动→设置→等待→提醒→休息→统计的完整链路。
* 性能与稳定性测试：长时间运行、睡眠/唤醒恢复、全屏/勿扰延后策略。
* 跨平台兼容测试：Windows/macOS/Linux 三平台核心流程一致。

---

# 二十、CI/CD 与质量门槛（CI/CD & Quality Gates）

* Lint 与格式：严格模式与统一风格。
* 单元与组件测试必须通过；设定基础覆盖率门槛。
* 国际化守卫：

  * 源码中文字符扫描（排除语言文件目录）。
  * 语言键一致性校验（至少 en 与 zh-CN 键集合一致）。
  * 文件编码检查（UTF-8 无 BOM）。
* 打包流程：三平台产物均应构建成功；校验产物内语言文件完整性。

---

# 二十一、验收标准（Acceptance Criteria）

1. 首次启动默认英文界面；切换到中文后，重启仍保持中文，界面无乱码与“豆腐块”。
2. 任意界面可见文本均来自语言文件；源码中不存在中文硬编码。
3. 依设置到达提醒时间时，提醒视图按选择的模式展示；强制休息时的交互限制如期生效。
4. 统计页面可展示今日与近 7 天等范围内的指标与时间轴，数据与实际操作一致。
5. 系统托盘与全局快捷键在三平台可用；开机自启按设置行为执行。
6. 睡眠/唤醒、全屏/勿扰等场景被正确识别并采取智能延后或恢复策略。
7. 长时间运行无明显时钟漂移与资源泄漏；后台占用低。
8. CI 守卫全部通过；打包产物在三平台可安装并运行。

---

# 二十二、可扩展性与后续路线（Extensibility & Roadmap）

* 预留主题包机制与插件式统计扩展点。
* 支持多语言扩展的加载与校验流程。
* 预留与外部设备或服务的集成接口（在不泄露隐私的前提下）。
* 引入个性化推荐的工作—休息比例模型（可选）。

---

# 二十三、开发约定（Conventions）

* 严格模式（strict）与类型完整性优先。
* 命名一致：布尔以 is/has/should 前缀；时间字段统一格式与时区策略。
* 组件无隐式副作用；跨进程交互集中到服务层，页面与组件仅消费已抽象的接口。
* 注释统一英文；说明清晰、意图明确、避免空泛描述。
* 所有新增功能需同时完善测试与文档条目。

---

# 二十四、交付物清单（Deliverables）

1. 完整可运行的 Tauri + React 桌面应用工程（含三平台打包配置）。
2. 语言文件（至少 en 与 zh-CN）、主题变量与基础样式。
3. 测试套件：单元、组件、集成与 E2E。
4. CI/CD 配置与质量守卫脚本。
5. README 与开发指南（安装、运行、调试、打包、签名、公证、问题排查）。
6. 使用指南（用户视角）与配置说明（管理员/高级用户视角）。

---

# 二十五、执行指令（Actionable Instructions for the Code Generator）

1. 按本文档建立与组织项目，确保跨平台与后续扩展。
2. 默认启用英文界面；接入国际化框架并加载语言文件；杜绝中文硬编码与乱码。
3. 实现定时调度、提醒视图、统计、设置、托盘、快捷键、多显示器与系统集成。
4. 建立稳定的 IPC 命令与事件，完成前后端双向校验与错误处理。
5. 提供本地数据库或等价持久化，并实现配置迁移与导入/导出。
6. 按照注释与文档规范完善英文注释；补齐测试与 CI 守卫；保证三平台构建与安装包可产出。
7. 依据验收标准自检，确保所有场景可用与体验达标。

---


